{% extends "base.html" %}

{% block title %}調味料編集 - 冷蔵庫管理アプリ{% endblock %}

{% block content %}
<div class="form-page">
    <h1>調味料の編集</h1>
    
    <form method="POST" id="editForm">
        <!-- 調味料名 -->
        <div class="form-group">
            <label for="name">調味料名 <span class="required">*必須</span></label>
            <input type="text" id="name" name="name" value="{{ item.name }}" required maxlength="50">
            <div class="char-count"><span id="charCount">{{ item.name|length }}</span> / 50文字</div>
        </div>
        
        <!-- 容器タイプ -->
        <div class="form-group">
            <label>容器タイプ <span class="required">*必須</span></label>
            <div class="radio-group">
                <label><input type="radio" name="container_type" value="1" {% if item.container_type == 1 %}checked{% endif %}> 液体ボトル</label>
                <label><input type="radio" name="container_type" value="2" {% if item.container_type == 2 %}checked{% endif %}> チューブ</label>
                <label><input type="radio" name="container_type" value="3" {% if item.container_type == 3 %}checked{% endif %}> 粉末ボトル</label>
            </div>
        </div>
        
        <!-- 残量レベル -->
        <div class="form-group">
            <label>残量レベル <span class="required">*必須</span></label>
            <div class="radio-group">
                <label><input type="radio" name="quantity_level" value="1" {% if item.quantity_level == 1 %}checked{% endif %}> 満タン</label>
                <label><input type="radio" name="quantity_level" value="2" {% if item.quantity_level == 2 %}checked{% endif %}> 半分</label>
                <label><input type="radio" name="quantity_level" value="3" {% if item.quantity_level == 3 %}checked{% endif %}> 少ない</label>
                <label><input type="radio" name="quantity_level" value="4" {% if item.quantity_level == 4 %}checked{% endif %}> なし</label>
            </div>
        </div>
        
        <!-- 賞味期限 -->
        <div class="form-group">
            <label for="expiry_date">賞味期限</label>
            <input type="date" id="expiry_date" name="expiry_date" value="{{ item.expiry_date }}">
            <div id="expiryWarning" class="warning-message" style="display: none;">
                ⚠️ 賞味期限が過去の日付です
            </div>
        </div>
        
        <!-- 開封日 -->
        <div class="form-group">
            <label for="opened_date">開封日</label>
            <input type="date" id="opened_date" name="opened_date" value="{{ item.opened_date }}">
            <div id="openedWarning" class="warning-message" style="display: none;">
                ⚠️ 開封日が未来の日付です
            </div>
        </div>
        
        <!-- メモ -->
        <div class="form-group">
            <label for="memo">メモ</label>
            <textarea id="memo" name="memo" rows="3" maxlength="200" placeholder="例: 鍋料理用、辛口">{{ item.memo or '' }}</textarea>
            <div class="char-count"><span id="memoCount">{{ (item.memo or '')|length }}</span> / 200文字</div>
        </div>
        
        <!-- ボタン -->
        <div class="form-actions">
            <a href="{{ url_for('items_list') }}" class="btn btn-secondary">キャンセル</a>
            <button type="submit" class="btn btn-primary">更新する</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
// 文字数カウント
const nameInput = document.getElementById('name');
const charCount = document.getElementById('charCount');
const memoInput = document.getElementById('memo');
const memoCount = document.getElementById('memoCount');

nameInput.addEventListener('input', () => {
    charCount.textContent = nameInput.value.length;
});

memoInput.addEventListener('input', () => {
    memoCount.textContent = memoInput.value.length;
});

// 日付検証
const expiryDate = document.getElementById('expiry_date');
const openedDate = document.getElementById('opened_date');
const expiryWarning = document.getElementById('expiryWarning');
const openedWarning = document.getElementById('openedWarning');

function validateDates() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // 賞味期限が過去の日付かチェック
    if (expiryDate.value) {
        const expiry = new Date(expiryDate.value);
        if (expiry < today) {
            expiryWarning.style.display = 'block';
        } else {
            expiryWarning.style.display = 'none';
        }
    } else {
        expiryWarning.style.display = 'none';
    }
    
    // 開封日が未来の日付かチェック
    if (openedDate.value) {
        const opened = new Date(openedDate.value);
        if (opened > today) {
            openedWarning.style.display = 'block';
        } else {
            openedWarning.style.display = 'none';
        }
    } else {
        openedWarning.style.display = 'none';
    }
}

// ページ読み込み時とフィールド変更時に検証
validateDates();
expiryDate.addEventListener('change', validateDates);
openedDate.addEventListener('change', validateDates);
</script>
{% endblock %}