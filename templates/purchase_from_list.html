{% extends "base.html" %}

{% block title %}è³¼å…¥ã—ã¦ç™»éŒ² - å†·è”µåº«ç®¡ç†ã‚¢ãƒ—ãƒª{% endblock %}

{% block content %}
<div class="form-page">
    <h1>ğŸ›’ è³¼å…¥ã—ã¦ç™»éŒ²</h1>
    <p style="color: #888; margin-bottom: 20px;">ã€Œ{{ shopping_item.item_name }}ã€ã‚’è³¼å…¥ã—ã¦å†·è”µåº«ã«ç™»éŒ²ã—ã¾ã™ã€‚</p>
    
    <form method="POST" id="purchaseForm">
        <!-- èª¿å‘³æ–™å -->
        <div class="form-group">
            <label for="name">èª¿å‘³æ–™å <span class="required">*å¿…é ˆ</span></label>
            <input type="text" id="name" name="name" value="{{ shopping_item.item_name }}" required maxlength="50">
            <div class="char-count"><span id="charCount">{{ shopping_item.item_name|length }}</span> / 50æ–‡å­—</div>
        </div>
        
        <!-- å®¹å™¨ã‚¿ã‚¤ãƒ— -->
        <div class="form-group">
            <label>å®¹å™¨ã‚¿ã‚¤ãƒ— <span class="required">*å¿…é ˆ</span></label>
            <div class="radio-group">
                <label><input type="radio" name="container_type" value="1" {% if shopping_item.container_type == 1 %}checked{% endif %}> æ¶²ä½“ãƒœãƒˆãƒ«</label>
                <label><input type="radio" name="container_type" value="2" {% if shopping_item.container_type == 2 %}checked{% endif %}> ãƒãƒ¥ãƒ¼ãƒ–</label>
                <label><input type="radio" name="container_type" value="3" {% if shopping_item.container_type == 3 %}checked{% endif %}> ç²‰æœ«ãƒœãƒˆãƒ«</label>
            </div>
        </div>
        
        <!-- æ®‹é‡ãƒ¬ãƒ™ãƒ« -->
        <div class="form-group">
            <label>æ®‹é‡ãƒ¬ãƒ™ãƒ« <span class="required">*å¿…é ˆ</span></label>
            <div class="radio-group">
                <label><input type="radio" name="quantity_level" value="1" checked> æº€ã‚¿ãƒ³</label>
                <label><input type="radio" name="quantity_level" value="2"> åŠåˆ†</label>
                <label><input type="radio" name="quantity_level" value="3"> å°‘ãªã„</label>
                <label><input type="radio" name="quantity_level" value="4"> ãªã—</label>
            </div>
        </div>
        
        <!-- è³å‘³æœŸé™ -->
        <div class="form-group">
            <label for="expiry_date">è³å‘³æœŸé™</label>
            <input type="date" id="expiry_date" name="expiry_date">
            <div id="expiryWarning" class="warning-message" style="display: none;">
                âš ï¸ è³å‘³æœŸé™ãŒéå»ã®æ—¥ä»˜ã§ã™
            </div>
        </div>
        
        <!-- é–‹å°æ—¥ -->
        <div class="form-group">
            <label for="opened_date">é–‹å°æ—¥</label>
            <input type="date" id="opened_date" name="opened_date">
            <div id="openedWarning" class="warning-message" style="display: none;">
                âš ï¸ é–‹å°æ—¥ãŒæœªæ¥ã®æ—¥ä»˜ã§ã™
            </div>
        </div>
        
        <!-- ãƒ¡ãƒ¢ -->
        <div class="form-group">
            <label for="memo">ãƒ¡ãƒ¢</label>
            <textarea id="memo" name="memo" rows="3" maxlength="200" placeholder="ä¾‹: é‹æ–™ç†ç”¨ã€è¾›å£">{{ shopping_item.memo or '' }}</textarea>
            <div class="char-count"><span id="memoCount">{{ (shopping_item.memo or '')|length }}</span> / 200æ–‡å­—</div>
        </div>
        
        <!-- ãƒœã‚¿ãƒ³ -->
        <div class="form-actions">
            <a href="{{ url_for('shopping_list') }}" class="btn btn-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
            <button type="submit" class="btn btn-primary">ç™»éŒ²ã—ã¦è²·ã„ç‰©ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
// æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
const nameInput = document.getElementById('name');
const charCount = document.getElementById('charCount');
const memoInput = document.getElementById('memo');
const memoCount = document.getElementById('memoCount');

nameInput.addEventListener('input', () => {
    charCount.textContent = nameInput.value.length;
});

memoInput.addEventListener('input', () => {
    memoCount.textContent = memoInput.value.length;
});

// æ—¥ä»˜æ¤œè¨¼
const expiryDate = document.getElementById('expiry_date');
const openedDate = document.getElementById('opened_date');
const expiryWarning = document.getElementById('expiryWarning');
const openedWarning = document.getElementById('openedWarning');

function validateDates() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    if (expiryDate.value) {
        const expiry = new Date(expiryDate.value);
        if (expiry < today) {
            expiryWarning.style.display = 'block';
        } else {
            expiryWarning.style.display = 'none';
        }
    } else {
        expiryWarning.style.display = 'none';
    }
    
    if (openedDate.value) {
        const opened = new Date(openedDate.value);
        if (opened > today) {
            openedWarning.style.display = 'block';
        } else {
            openedWarning.style.display = 'none';
        }
    } else {
        openedWarning.style.display = 'none';
    }
}

expiryDate.addEventListener('change', validateDates);
openedDate.addEventListener('change', validateDates);
</script>
{% endblock %}