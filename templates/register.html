{% extends "base.html" %}

{% block title %}{{ category_name }}登録 - 冷蔵庫管理アプリ{% endblock %}

{% block content %}
<div class="form-page">
    <h1>{{ category_name }}の登録</h1>
    
    <form method="POST" id="registerForm">
        <!-- 調味料名 -->
        <div class="form-group">
            <label for="name">{{ category_name }}名 <span class="required">*必須</span></label>
            <input type="text" id="name" name="name" required maxlength="50" placeholder="例: しょうゆ">
            <div class="char-count"><span id="charCount">0</span> / 50文字</div>
        </div>
        
        <!-- カテゴリ -->
        <div class="form-group">
            <label for="category_id">カテゴリ <span class="required">*必須</span></label>
            <select id="category_id" name="category_id" required>
                {% for category in categories %}
                <option value="{{ category.id }}" {% if category.id == current_category %}selected{% endif %}>
                    {{ category.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <!-- 容器タイプ -->
        <div class="form-group">
            <label>容器タイプ <span class="required">*必須</span></label>
            <div class="radio-group">
                <label><input type="radio" name="container_type" value="1" checked> 液体ボトル</label>
                <label><input type="radio" name="container_type" value="2"> チューブ</label>
                <label><input type="radio" name="container_type" value="3"> 粉末ボトル</label>
            </div>
        </div>
        
        <!-- 残量レベル -->
        <div class="form-group">
            <label>残量レベル <span class="required">*必須</span></label>
            <div class="radio-group">
                <label><input type="radio" name="quantity_level" value="1" checked> 満タン</label>
                <label><input type="radio" name="quantity_level" value="2"> 半分</label>
                <label><input type="radio" name="quantity_level" value="3"> 少ない</label>
                <label><input type="radio" name="quantity_level" value="4"> なし</label>
            </div>
        </div>
        
        <!-- 賞味期限 -->
        <div class="form-group">
            <label for="expiry_date">賞味期限</label>
            <input type="date" id="expiry_date" name="expiry_date">
            <div id="expiryWarning" class="warning-message" style="display: none;">
                ⚠️ 賞味期限が過去の日付です
            </div>
        </div>
        
        <!-- 開封日 -->
        <div class="form-group">
            <label for="opened_date">開封日</label>
            <input type="date" id="opened_date" name="opened_date">
            <div id="openedWarning" class="warning-message" style="display: none;">
                ⚠️ 開封日が未来の日付です
            </div>
        </div>
        
        <!-- メモ -->
        <div class="form-group">
            <label for="memo">メモ</label>
            <textarea id="memo" name="memo" rows="3" maxlength="200" placeholder="例: 鍋料理用、辛口"></textarea>
            <div class="char-count"><span id="memoCount">0</span> / 200文字</div>
        </div>
        
        <!-- ボタン -->
        <div class="form-actions">
            <a href="{{ url_for('items_list', category=current_category) }}" class="btn btn-secondary">キャンセル</a>
            <button type="submit" class="btn btn-primary">登録する</button>
        </div>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
// 文字数カウント
const nameInput = document.getElementById('name');
const charCount = document.getElementById('charCount');
const memoInput = document.getElementById('memo');
const memoCount = document.getElementById('memoCount');

nameInput.addEventListener('input', () => {
    charCount.textContent = nameInput.value.length;
});

memoInput.addEventListener('input', () => {
    memoCount.textContent = memoInput.value.length;
});

// 日付検証
const expiryDate = document.getElementById('expiry_date');
const openedDate = document.getElementById('opened_date');
const expiryWarning = document.getElementById('expiryWarning');
const openedWarning = document.getElementById('openedWarning');

function validateDates() {
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    // 賞味期限が過去の日付かチェック
    if (expiryDate.value) {
        const expiry = new Date(expiryDate.value);
        if (expiry < today) {
            expiryWarning.style.display = 'block';
        } else {
            expiryWarning.style.display = 'none';
        }
    } else {
        expiryWarning.style.display = 'none';
    }
    
    // 開封日が未来の日付かチェック
    if (openedDate.value) {
        const opened = new Date(openedDate.value);
        if (opened > today) {
            openedWarning.style.display = 'block';
        } else {
            openedWarning.style.display = 'none';
        }
    } else {
        openedWarning.style.display = 'none';
    }
}

expiryDate.addEventListener('change', validateDates);
openedDate.addEventListener('change', validateDates);
</script>
{% endblock %}